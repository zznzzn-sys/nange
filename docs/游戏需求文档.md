# 月球生存游戏 - 需求文档

## 版本信息
- **文档版本**: v1.0
- **游戏版本**: 当前开发版本
- **更新日期**: 2024年
- **文档状态**: 基于当前实现的功能整理

---

## 1. 游戏概述

### 1.1 游戏类型
- **类型**: 2D横版生存探索游戏
- **平台**: Web浏览器（基于Vue 3 + Canvas）
- **风格**: 像素风格，科幻主题

### 1.2 游戏背景
玩家扮演一名被困在月球的宇航员，需要收集资源、制作工具、对抗怪物，最终修复飞船逃离月球。

### 1.3 核心玩法
- **资源收集**: 挖掘各种矿石和材料
- **工具制作**: 通过工作台合成高级工具
- **战斗系统**: 使用武器对抗怪物
- **探索系统**: 探索不同区域，发现隐藏资源
- **BOSS战**: 挑战最终BOSS获取关键道具

---

## 2. 核心系统

### 2.1 物理引擎
- **重力系统**: 月球重力（1/4地球重力）
- **碰撞检测**: 矩形碰撞检测系统
- **移动系统**: 
  - 基础移动速度: 280 * 1.3 像素/秒
  - 奔跑速度: 400 * 1.5 像素/秒（按住Shift）
  - 跳跃初速度: 820 像素/秒
  - 最大跳跃高度: 200像素
  - 空气阻力: 0.9

### 2.2 地图系统
- **地图尺寸**: 10000px × 10000px
- **坐标系统**: 
  - X轴: -5000 到 5000
  - Y轴: -5000 到 5000（Y=0为地面）
- **视口系统**: 1920×1080画布，跟随玩家移动
- **动态生成**: 基于瓦片的地图生成系统

### 2.3 游戏状态管理
- **本地存储**: 使用localStorage保存游戏进度
- **保存内容**:
  - 游戏时间
  - 资源数量
  - 拥有的工具
  - 游戏标志（如BOSS击败状态）
  - 能源状态

---

## 3. 玩家系统

### 3.1 基础属性
- **尺寸**: 51×66像素
- **生命值**: HP系统（可被怪物攻击）
- **体力系统**: 
  - 最大体力: 2000
  - 体力消耗: 每分钟减少1点
  - 射击消耗: 每发子弹1点
  - 被动恢复: 每分钟1.5点（未受攻击时）
  - 食物恢复: 每个食物包1000点
  - 水恢复: 每瓶水400点

### 3.2 控制方式
- **键盘控制**:
  - A/←: 向左移动
  - D/→: 向右移动
  - W/↑/空格: 跳跃
  - Shift: 奔跑
  - 鼠标左键: 射击/使用工具
  - 鼠标滚轮: 切换武器工具（上层0-7）
  - 数字键1-8: 切换采集工具（下层9-16）
  - E: 交互（工作台、能源系统等）

### 3.3 装备系统
- **装备格子**: 16个格子，分为两层
  - **上层（0-7）**: 武器工具层，鼠标滚轮切换
  - **下层（9-16）**: 采集工具层，数字键1-8切换
- **初始装备**:
  - 基础激光镐（工具）
  - 电击枪（武器）
  - 光子盾（防御）

### 3.4 资源格子系统
- **资源格子**: 8个格子用于存储采集的资源
- **资源类型**: 
  - 月球玄武岩
  - 月球硅石
  - 钛铁矿
  - 月球水冰
  - 石英模块
  - 等

---

## 4. 武器和工具系统

### 4.1 武器

#### 4.1.1 电击枪 ⚡
- **类型**: 初始武器
- **功能**: 发射电击子弹攻击敌人
- **特性**: 
  - 可穿透多个怪物
  - 连发系统（快速点击可提升射速）
  - 基础冷却: 200ms
  - 最小冷却: 50ms
- **充能**: 在工作台消耗10点能源获得30发子弹

#### 4.1.2 光子盾 🛡️
- **类型**: 防御装备
- **功能**: 吸收伤害，保护玩家
- **充能**: 在工作台消耗10点能源获得20点能量（最大20点）

### 4.2 工具

#### 4.2.1 基础激光镐 🔨
- **类型**: 初始工具
- **功能**: 挖掘月球玄武岩
- **挖掘时间**: 3秒/单位
- **挖掘范围**: 500像素
- **能量**: 100/100

#### 4.2.2 高级激光镐 ⚡
- **类型**: 合成工具
- **合成配方**: 基础激光镐 + 钛铁矿×3 + 月球硅石模块×2
- **功能**: 挖掘深层岩石（钛铁矿）
- **挖掘时间**: 5秒/单位（钛铁矿）

#### 4.2.3 地质探测器 📡
- **类型**: 合成工具
- **合成配方**: 月球硅石模块×2 + 月球玄武岩×1
- **功能**: 定位深层钛铁矿矿点
- **使用方式**: 自动扫描或手动点击扫描

#### 4.2.4 钻探机 🛠️
- **类型**: 合成工具
- **合成配方**: 月球玄武岩×5 + 月球硅石模块×2
- **功能**: 在永久阴影区提取月球水冰
- **部署要求**: 必须在永久阴影区内
- **提取机制**: 
  - 每10秒提取2单位水冰
  - 每秒消耗1单位能源
  - 需要装备冷凝模块才能激活

#### 4.2.5 冷凝模块 ❄️
- **类型**: 钻探机配套模块
- **合成配方**: 月球硅石模块×3 + 钛铁矿×1
- **功能**: 使钻探机能够冷凝提取的水冰

#### 4.2.6 机械拆解机 🔧
- **类型**: 合成工具
- **合成配方**: 钛铁矿×3 + 月球硅石模块×2 + 月球玄武岩×1
- **功能**: 拆解陨石和废弃探测器
- **获取**: 每次拆解获得2-5单位陨石碎片，30%概率获得探测器残骸

---

## 5. 资源系统

### 5.1 基础资源

#### 5.1.1 月球玄武岩 🪨
- **位置**: 月球表面任意区域
- **工具**: 基础激光镐
- **获取时间**: 3秒/单位
- **用途**: 合成多种工具和模块

#### 5.1.2 月球硅石
- **位置**: 雨海区域（陨石中）
- **工具**: 基础激光镐
- **获取方式**: 挖掘陨石
- **用途**: 合成硅石模块

#### 5.1.3 钛铁矿 ⛏️
- **位置**: 风暴洋、澄海玄武岩深层区
- **工具**: 高级激光镐 + 地质探测器
- **获取时间**: 5秒/单位
- **获取方式**: 
  1. 使用地质探测器定位矿点
  2. 使用高级激光镐挖掘
- **用途**: 合成高级工具

#### 5.1.4 月球水冰 🧊
- **位置**: 南极/北极永久阴影区
- **工具**: 钻探机 + 冷凝模块
- **获取方式**: 
  1. 部署钻探机
  2. 装备冷凝模块
  3. 激活钻探机
  4. 每10秒自动提取2单位
- **用途**: 重要合成材料

#### 5.1.5 石英模块
- **位置**: 雨海区域（石英岩中）
- **工具**: 基础激光镐
- **获取时间**: 3秒/单位
- **用途**: 合成太阳能充电板等

### 5.2 特殊资源

#### 5.2.1 无尽能源 ♾️
- **位置**: 击败BOSS「谱尼」后唯一获得
- **获取方式**: 击败谱尼后自动掉落，收集后存入工作台
- **特性**: 
  - 大型掉落物，带发光效果
  - 漂浮动画效果
  - 自动旋转
- **用途**: 飞船最终修复与起飞的关键能源核心

#### 5.2.2 废弃卫星的太阳能电池板 🔋
- **位置**: 风暴洋、澄海玄武岩地区
- **获取方式**: 挖掘玄武岩时30%概率掉落
- **价值**: 150
- **用途**: 合成材料

#### 5.2.3 陨石碎片 🌠
- **位置**: 随机刷新的陨石撞击坑
- **工具**: 机械拆解机
- **获取方式**: 撞击坑生成后1小时内可拆解
- **获取数量**: 每次2-5单位
- **额外奖励**: 30%概率获得探测器残骸

#### 5.2.4 飞船零件 🚀
- **位置**: 风暴洋区域的废弃飞船
- **获取方式**: 拆解废弃飞船
- **用途**: 修复飞船

---

## 6. 怪物系统

### 6.1 普通怪物

#### 6.1.1 怪兽1号
- **生命值**: 30
- **伤害**: 1
- **速度**: 40像素/秒
- **价值**: 50
- **攻击方式**: 追踪元气弹（距离<300像素时发射）

#### 6.1.2 洞刺兽 🦏
- **位置**: 风暴洋、澄海玄武岩地区
- **生命值**: 60
- **伤害**: 5
- **速度**: 200像素/秒（基础），300像素/秒（奔跑）
- **价值**: 100
- **体型**: 70×50像素
- **外观**: 像素风格野猪，背部有晶体
- **攻击方式**:
  1. **晶体喷射**: 距离5-10米时，发射抛物线晶体子弹
  2. **冲锋顶撞**: 距离<3米时，以600像素/秒速度冲锋
- **AI行为**: 
  - 追踪距离: 1200像素
  - 射击范围: 150-800像素
  - 射击冷却: 1.0秒
- **弱点**: 保持距离，利用远程武器攻击背部晶体

#### 6.1.3 雨海飞虫 🦋
- **位置**: 雨海区域、风暴洋区域
- **生命值**: 25
- **伤害**: 3（子弹）
- **速度**: 150像素/秒（飞行）
- **价值**: 80
- **体型**: 30×30像素
- **外观**: 蓝色飞行小怪物，像素风格
- **攻击方式**: 
  - 发射直线子弹
  - 射击间隔: 2-4秒
  - 射击范围: 检测玩家距离
- **移动方式**: 
  - 在区域内自由飞行
  - 正弦波上下浮动
  - 水平徘徊移动
- **生成数量**: 
  - 雨海区域: 20只
  - 风暴洋区域: 15只

### 6.2 BOSS

#### 6.2.1 谱尼 👾
- **位置**: 未知区域中心
- **生命值**: 10000
- **体型**: 2000×800像素（巨大）
- **攻击范围**: 3000像素
- **形态系统**: 
  - **原初形态**: HP > 50%
  - **进化形态**: HP ≤ 50%
- **技能系统**（根据血量阶段）:

**第一阶段（100%-70%）**:
- 四周激光（散射一圈激光子弹）
- 散发激光球（从中心持续散发）
- 十字激光阵（向四个方向发射激光）
- 成群子弹（向玩家发射大量子弹）

**第二阶段（70%-40%）**:
- 增加: 千烈虚光闪、扇形弹幕、元气弹

**第三阶段（40%-20%）**:
- 增加: 旋灭裂空阵、跟踪子弹、旋转弹幕、圣光气

**第四阶段（20%-0%）**:
- 所有技能可用，包括: 圣灵魔闪光、圣影流光破、璀灵圣光、连续冲刺、激光扫射、区域爆炸

**进化形态技能**:
- 追踪能量波（缓慢追踪玩家）
- 扇形弹幕
- 跟踪子弹
- 旋转弹幕
- 其他强力技能

**技能特点**:
- 所有技能都可躲避
- 技能有冷却时间
- 根据血量动态调整技能池
- 技能伤害: 6-15点不等

**击败奖励**:
- 掉落「无尽能源」（大型掉落物）
- 金钱奖励: 10000
- 解锁结局剧情

---

## 7. 区域系统

### 7.1 基地区域
- **位置**: 游戏起始点
- **功能**: 
  - 飞船停靠点
  - 工作台交互
  - 能源系统管理
  - 资源储藏

### 7.2 雨海区域
- **位置**: Y轴 -3000 到 -750，整个X轴范围
- **特点**: 地面上方区域，需要跳跃或飞行到达
- **资源**: 
  - 陨石（含月球硅石）
  - 石英岩（含石英模块）
- **怪物**: 雨海飞虫（20只）
- **地形**: 固定陨石分布

### 7.3 风暴洋、澄海玄武岩地区
- **位置**: X轴 -3500 到 3500，Y轴 -750 到 0
- **特点**: 地面附近区域
- **资源**: 
  - 玄武岩（地面）
  - 钛铁矿（深层，需探测器定位）
  - 废弃卫星的太阳能电池板（30%概率）
- **怪物**: 
  - 洞刺兽（地面）
  - 雨海飞虫（15只，飞行）
- **地形**: 飞船碎片、悬浮平台

### 7.4 永久阴影区
- **位置**: 
  - **南极**: X轴 3500 到 5000，Y轴 -750 到 100
  - **北极**: X轴 -5000 到 -3500，Y轴 -750 到 100
- **特点**: 永久黑暗区域
- **资源**: 月球水冰（需钻探机提取）
- **限制**: 只有在此区域才能部署钻探机

### 7.5 未知区域
- **位置**: Y轴 -5000 到 -3000，整个X轴范围
- **特点**: 地图最底部区域
- **BOSS**: 谱尼（中心位置）
- **进入条件**: 需要深入探索

---

## 8. 工作台系统

### 8.1 功能模块

#### 8.1.1 资源储藏
- **功能**: 查看和管理所有收集的资源
- **显示内容**: 
  - 资源名称
  - 资源图标
  - 资源数量
- **特殊资源**: 无尽能源（击败谱尼后获得）

#### 8.1.2 资源合成
- **功能**: 使用资源合成工具和模块
- **合成配方**:
  - 钻探机: 月球玄武岩×5 + 月球硅石模块×2
  - 冷凝模块: 月球硅石模块×3 + 钛铁矿×1
  - 高级激光镐: 基础激光镐 + 钛铁矿×3 + 月球硅石模块×2
  - 地质探测器: 月球硅石模块×2 + 月球玄武岩×1
  - 机械拆解机: 钛铁矿×3 + 月球硅石模块×2 + 月球玄武岩×1
  - 太阳能充电板: 钛铁矿×2 + 月球玄武岩×3 + 石英模块×2

#### 8.1.3 图鉴系统
- **功能**: 查看游戏内所有物品、怪物、工具的详细信息
- **分类**: 
  - 资源图鉴
  - 工具图鉴
  - 怪物图鉴
  - 装置图鉴

### 8.2 充能系统
- **电击枪充能**: 消耗10点能源 → 30发子弹
- **光子盾充能**: 消耗10点能源 → 20点能量

---

## 9. 能源系统

### 9.1 基础能源
- **初始能源**: 200点
- **最大能源**: 200点（可通过太阳能充电板增加）
- **能源消耗**: 
  - 电击枪充能: 10点/次
  - 光子盾充能: 10点/次
  - 钻探机运行: 1点/秒

### 9.2 太阳能充电板
- **功能**: 增加能源上限10点
- **合成**: 钛铁矿×2 + 月球玄武岩×3 + 石英模块×2
- **使用**: 在能源系统面板中使用

---

## 10. 结局系统

### 10.1 结局触发条件
- 击败BOSS「谱尼」
- 获得「无尽能源」
- 返回基地与AI交互

### 10.2 结局动画
- **多场景动画系统**:
  1. **月球表面准备起飞**（4秒）
  2. **起飞**（5秒）
  3. **太空飞行**（8秒）
  4. **接近地球**（5秒）
  5. **降落**（4秒）
  6. **淡出**（2秒）
- **动画特点**: 
  - 星空背景
  - 动态星球
  - 飞船动画
  - 平滑过渡

### 10.3 结局对话
- **对话系统**: 多段对话展示
- **对话内容**: 描述逃离过程和最终回归
- **自动播放**: 动画自动播放，结束后返回游戏开始界面

---

## 11. 技术实现

### 11.1 技术栈
- **框架**: Vue 3 (Composition API)
- **构建工具**: Vite
- **渲染**: Canvas 2D API
- **状态管理**: Vue响应式系统
- **数据持久化**: localStorage

### 11.2 核心算法

#### 11.2.1 游戏循环
- **实现**: requestAnimationFrame
- **更新频率**: ~60fps
- **更新内容**: 
  - 物理系统
  - 怪物AI
  - 碰撞检测
  - 渲染系统

#### 11.2.2 碰撞检测
- **方法**: 矩形碰撞检测（rectsCollide）
- **应用**: 
  - 玩家与障碍物
  - 玩家与怪物
  - 子弹与目标
  - 掉落物收集

#### 11.2.3 怪物AI
- **移动AI**: 
  - 小范围徘徊
  - 追踪玩家
  - 区域限制
- **攻击AI**: 
  - 距离检测
  - 冷却时间
  - 弹道计算

### 11.3 性能优化
- **对象清理**: 超出视口的对象自动清理
- **区域限制**: 怪物限制在生成区域内
- **批量生成**: 游戏开始时批量生成固定对象
- **动态加载**: 按需生成地图瓦片

---

## 12. 游戏流程

### 12.1 游戏开始
1. 玩家在飞船内醒来
2. 获得初始装备（基础激光镐、电击枪、光子盾）
3. 离开飞船开始探索

### 12.2 资源收集阶段
1. 使用基础激光镐挖掘玄武岩
2. 探索雨海区域，挖掘陨石获取硅石
3. 合成高级工具（地质探测器、高级激光镐）
4. 挖掘钛铁矿
5. 合成钻探机和冷凝模块

### 12.3 水冰提取阶段
1. 前往永久阴影区
2. 部署钻探机
3. 装备冷凝模块
4. 激活钻探机提取水冰

### 12.4 BOSS战阶段
1. 深入未知区域
2. 挑战谱尼BOSS
3. 躲避各种技能攻击
4. 击败BOSS获得无尽能源

### 12.5 结局阶段
1. 返回基地
2. 与AI交互
3. 观看结局动画
4. 返回游戏开始界面

---

## 13. 未来扩展建议

### 13.1 功能扩展
- [ ] 更多怪物类型
- [ ] 更多区域探索
- [ ] 更多工具和武器
- [ ] 任务系统
- [ ] 成就系统
- [ ] 多人模式

### 13.2 内容扩展
- [ ] 更多资源类型
- [ ] 更多合成配方
- [ ] 更多BOSS战
- [ ] 更多剧情对话

### 13.3 技术优化
- [ ] 性能优化
- [ ] 移动端适配
- [ ] 音效系统完善
- [ ] 存档系统优化

---

## 14. 已知问题和限制

### 14.1 已知问题
- 部分怪物AI可能需要进一步优化
- 某些资源生成概率可能需要调整
- 钻探机部署区域限制较严格

### 14.2 技术限制
- 基于Canvas 2D，3D效果有限
- 本地存储容量限制
- 浏览器兼容性要求

---

## 附录

### A. 快捷键列表
- **A/←**: 向左移动
- **D/→**: 向右移动
- **W/↑/空格**: 跳跃
- **Shift**: 奔跑
- **鼠标左键**: 射击/使用工具
- **鼠标滚轮**: 切换武器工具
- **数字键1-8**: 切换采集工具
- **E**: 交互

### B. 资源获取速查表
| 资源 | 位置 | 工具 | 时间 | 概率 |
|------|------|------|------|------|
| 月球玄武岩 | 任意表面 | 基础激光镐 | 3秒 | 100% |
| 月球硅石 | 雨海陨石 | 基础激光镐 | 3秒 | 100% |
| 钛铁矿 | 风暴洋深层 | 高级激光镐 | 5秒 | 需探测器 |
| 月球水冰 | 永久阴影区 | 钻探机 | 10秒/2单位 | 100% |
| 石英模块 | 雨海石英岩 | 基础激光镐 | 3秒 | 100% |
| 太阳能电池板 | 风暴洋玄武岩 | 基础激光镐 | - | 30% |

### C. 合成配方速查表
| 物品 | 材料 | 数量 |
|------|------|------|
| 钻探机 | 月球玄武岩 + 月球硅石模块 | 5 + 2 |
| 冷凝模块 | 月球硅石模块 + 钛铁矿 | 3 + 1 |
| 高级激光镐 | 基础激光镐 + 钛铁矿 + 月球硅石模块 | 1 + 3 + 2 |
| 地质探测器 | 月球硅石模块 + 月球玄武岩 | 2 + 1 |
| 机械拆解机 | 钛铁矿 + 月球硅石模块 + 月球玄武岩 | 3 + 2 + 1 |
| 太阳能充电板 | 钛铁矿 + 月球玄武岩 + 石英模块 | 2 + 3 + 2 |

---

**文档结束**

